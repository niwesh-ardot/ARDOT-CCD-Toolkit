<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Proposal Checklist - CCD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <!-- PDF OCR + markup dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
</head>
<body>
  <div class="app">

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo-circle">CC</div>
        <div class="sidebar-title">
          <h1>ARDOT </h1>
          <p>CCD Toolkit</p>
        </div>
      </div>

      <nav class="nav">
        <button class="nav-item active" type="button" data-section-target="checklist">
          <span class="nav-icon" aria-hidden="true"></span>
          <span>Proposal Checklist</span>
        </button>
        <button class="nav-item" type="button" data-section-target="checker" data-scroll-target="#proposal-checker">
          <span class="nav-icon" aria-hidden="true"></span>
          <span>Proposal Checker</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <p>Built for Construction Contracts Development reviews.</p>
      </div>
    </aside>

    <!-- Main area -->
    <div class="main">

      <!-- Top bar -->
      <header class="topbar" data-section="checklist">
        <div class="topbar-inner">
          <div class="topbar-row">
            <div class="topbar-left">
              <div class="brand-lockup">
                <img src="assets/ardot-logo.svg" alt="ARDOT logo" class="ardot-logo" />
                <div>
                  <h2>Proposal Checklist</h2>
                  <p>Track CCD proposal reviews, notes, and completion in one place.</p>
                </div>
              </div>
            </div>

            <div class="toolbar-actions">
              <button id="btn-save-json" class="btn-ghost">Save JSON</button>
              <button id="btn-load-json" class="btn-ghost">Load JSON</button>
              <button id="btn-export-pdf" class="btn-primary">Download PDF</button>
              <input
                type="file"
                id="file-load-json"
                accept="application/json"
                hidden
              />
            </div>
          </div>

          <div class="topbar-grid">
            <div class="search-wrapper">
              <span class="search-icon" aria-hidden="true"></span>
              <input
                type="text"
                id="searchInput"
                placeholder="Search sections or checklist items"
              />
            </div>

            <div class="stat-chips">
              <div class="chip">
                <span class="chip-label">Total</span>
                <span class="chip-value" id="stat-total">0</span>
              </div>
              <div class="chip chip-success">
                <span class="chip-label">Completed</span>
                <span class="chip-value" id="stat-complete">0</span>
              </div>
              <div class="chip chip-warn">
                <span class="chip-label">Remaining</span>
                <span class="chip-value" id="stat-remaining">0</span>
              </div>
              <div class="chip chip-progress">
                <span class="chip-label">Progress</span>
                <span class="chip-value" id="progressText">0/0 (0%)</span>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Content -->
      <main class="content">

        <section class="layout-grid" data-section="checklist">

          <!-- Metadata column -->
          <div class="card meta-card">
            <div class="card-header">
              <h3>Project &amp; Review Metadata</h3>
              <p>Verify job number, funding, and review info before you begin.</p>
            </div>

            <div class="card-body">

              <div class="field-grid">
                <label class="field">
                  <span>Call No.</span>
                  <input type="text" id="meta-callNo" />
                </label>

                <label class="field">
                  <span>Job No.</span>
                  <input type="text" id="meta-jobNo" list="jobNoOptions" />
                  <datalist id="jobNoOptions"></datalist>
                </label>

                <label class="field">
                  <span>FAP No.</span>
                  <input type="text" id="meta-fapNo" />
                </label>

                <label class="field field-wide">
                  <span>Job Name</span>
                  <input type="text" id="meta-jobName" />
                </label>

                <label class="field field-wide">
                  <span>Route / Section</span>
                  <input type="text" id="meta-routeSection" />
                </label>

                <label class="field">
                  <span>County(ies)</span>
                  <input type="text" id="meta-county" />
                </label>

                <label class="field">
                  <span>District</span>
                  <input type="text" id="meta-district" />
                </label>

                <label class="field">
                  <span>Letting Time</span>
                  <input type="text" id="meta-lettingTime" placeholder="10:00 or 1:30" />
                </label>

                <label class="field">
                  <span>Reviewer initials</span>
                  <input type="text" id="meta-reviewer" />
                </label>

                <label class="field">
                  <span>Review date</span>
                  <input type="date" id="meta-reviewDate" />
                </label>
              </div>

              <div class="divider"></div>

              <div class="flag-grid">
                <label class="check-row">
                  <input type="checkbox" id="meta-stateFunded" />
                  <span>100% State funded project</span>
                </label>
                <label class="check-row">
                  <input type="checkbox" id="meta-federallyFunded" />
                  <span>Federally funded project</span>
                </label>
              </div>

              <div class="meta-legend">
                <p>
                  This web checklist mirrors the CCD paper form. You can use it
                  as a review helper and then file the official PDF or hard copy.
                </p>
              </div>

              <div class="meta-badges">
                <span class="badge" id="badge-state" hidden>State funded</span>
                <span class="badge badge-info" id="badge-fed" hidden>Federal aid</span>
              </div>

              <div class="general-notes">
                <label class="field field-wide">
                  <span>General comments / notes</span>
                  <textarea
                    id="meta-generalComments"
                    rows="4"
                    placeholder="Overall notes about this proposal"
                  ></textarea>
                </label>
              </div>
            </div>
          </div>

          <!-- Checklist column -->
          <div class="card checklist-card">
            <div class="card-header">
              <div>
                <h3>Checklist items</h3>
                <p>Tick items as you verify them. Add quick notes for anything that needs follow up.</p>
              </div>
            </div>

            <div class="card-body checklist-body">
              <div id="checklistContainer" class="checklist-container">
                <!-- Populated by script.js -->
              </div>
            </div>
          </div>

        </section>

        <div class="footer-actions" data-section="checklist">
          <button id="btn-clear-all" class="btn-danger">Clear ticks/notes &amp; metadata</button>
        </div>

        <!-- Proposal checker (PDF OCR + Markup) -->
        <section id="proposal-checker" class="card ocr-card" data-section="checker">
          <div class="card-header">
            <div class="ocr-header">
              <div>
                <h3>Proposal Checker (PDF OCR + Markup)</h3>
                <p>Convert scanned proposal PDFs to editable text, mark up pages, and export a stamped copy.</p>
              </div>
              <div class="ocr-badges">
                <span class="badge">In-browser</span>
                <span class="badge badge-info">No upload</span>
              </div>
            </div>
          </div>

          <div class="card-body ocr-body">
            <div class="ocr-grid">
              <div class="ocr-col">
                <div class="ocr-panel">
                  <div class="ocr-panel-header">
                    <h4>Upload &amp; OCR</h4>
                    <div class="ocr-actions">
                      <label class="file-btn">
                        <input id="ocrFile" type="file" accept="application/pdf" />
                        <span>Select PDF</span>
                      </label>
                      <button id="ocrStart" class="btn-primary" disabled>Start OCR</button>
                      <button id="ocrCancel" class="btn-ghost" disabled>Cancel</button>
                    </div>
                  </div>

                  <div class="ocr-fields">
                    <label class="field">
                      <span>OCR language</span>
                      <select id="ocrLang">
                        <option value="eng" selected>English (eng)</option>
                      </select>
                    </label>
                    <label class="field">
                      <span>Render scale</span>
                      <select id="ocrScale">
                        <option value="1.5">1.5x (faster)</option>
                        <option value="2" selected>2x (balanced)</option>
                        <option value="3">3x (better OCR, slower)</option>
                      </select>
                    </label>
                  </div>

                  <div class="ocr-progress">
                    <div class="ocr-progress-bar">
                      <div id="ocrProgressBar" class="ocr-progress-fill" style="width: 0%"></div>
                    </div>
                    <div id="ocrProgressText" class="ocr-progress-text">No file selected.</div>
                  </div>

                  <div id="ocrLog" class="ocr-log" aria-live="polite"></div>
                </div>

                <div class="ocr-panel">
                  <div class="ocr-panel-header">
                    <h4>Recognized Text</h4>
                    <div class="ocr-actions">
                      <button id="ocrCopy" class="btn-ghost" disabled>Copy</button>
                      <button id="ocrDownload" class="btn-ghost" disabled>Download .txt</button>
                      <button id="ocrClear" class="btn-ghost">Clear</button>
                    </div>
                  </div>
                  <textarea
                    id="ocrOutput"
                    class="ocr-output"
                    placeholder="OCR text will appear here..."
                    spellcheck="true"
                  ></textarea>
                  <div class="ocr-hint">Tip: If OCR misses characters, try a higher render scale or a clearer scan.</div>
                </div>
              </div>

              <div class="ocr-col">
                <div class="ocr-panel">
                    <div class="ocr-panel-header">
                      <h4>PDF Viewer &amp; Markup</h4>
                      <div class="viewer-controls">
                        <button id="ocrPrevPage" class="btn-ghost" disabled>Prev</button>
                        <div class="viewer-page">Page <span id="ocrPageNum">0</span> / <span id="ocrPageCount">0</span></div>
                        <div class="viewer-jump">
                          <input id="ocrPageInput" type="number" min="1" value="1" disabled aria-label="Go to page" />
                          <span class="viewer-jump-label">Go</span>
                        </div>
                        <button id="ocrNextPage" class="btn-ghost" disabled>Next</button>
                        <div class="viewer-slider">
                          <input id="ocrPageSlider" type="range" min="1" max="1" value="1" disabled />
                          <span id="ocrPageSliderValue" class="viewer-slider-value">Page 0</span>
                        </div>
                      </div>
                    </div>

                  <div class="tool-row">
                    <div class="tool-group" role="toolbar" aria-label="Markup tools">
                      <button class="tool-btn active" data-tool="pen">Pen</button>
                      <button class="tool-btn" data-tool="highlighter">Highlighter</button>
                      <button class="tool-btn" data-tool="eraser">Eraser</button>
                      <button class="tool-btn" data-tool="stamp">Stamp</button>
                    </div>

                    <div class="tool-group">
                      <label class="mini-field">
                        <span>Size</span>
                        <input id="ocrBrushSize" type="range" min="2" max="28" value="6" />
                      </label>
                      <label class="mini-field">
                        <span>Color</span>
                        <input id="ocrBrushColor" type="color" value="#ffcc00" />
                      </label>
                    </div>

                    <div class="tool-group">
                      <div class="zoom-controls">
                        <button id="ocrZoomOut" class="btn-ghost" disabled>-</button>
                        <span id="ocrZoomValue" class="zoom-value">100%</span>
                        <button id="ocrZoomIn" class="btn-ghost" disabled>+</button>
                      </div>
                    </div>
                  </div>

                  <div class="tool-row tool-row-actions">
                    <div class="tool-group">
                      <button id="ocrMarkAll" class="btn-ghost" disabled>Mark all pages</button>
                      <button id="ocrUnmarkAll" class="btn-ghost" disabled>Remove mark all pages</button>
                      <button id="ocrClearMarkup" class="btn-ghost" disabled>Clear markup</button>
                    </div>
                    <button id="ocrExportPdf" class="btn-primary" disabled>Export marked PDF</button>
                  </div>

                  <div class="viewer-shell">
                    <div class="canvas-stack">
                      <canvas id="ocrPdfCanvas"></canvas>
                      <canvas id="ocrMarkupCanvas"></canvas>
                    </div>
                  </div>

                  <div class="stamp-row">
                    <input
                      id="ocrStampText"
                      type="text"
                      placeholder="Stamp text (example: APPROVED, SIGNED, 12/16/2025)"
                    />
                    <button id="ocrApplyStamp" class="btn-ghost" disabled>Place stamp</button>
                  </div>
                </div>
              </div>
            </div>
            <canvas id="ocrHiddenCanvas" class="hidden"></canvas>
          </div>
        </section>
      </main>
    </div>
  </div>
    <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <script src="script.js"></script>
</body>
</html>
